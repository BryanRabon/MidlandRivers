<!DOCTYPE html>
      <head>
      <style>
      .dataTable {
font-size:9pt;
font-family:Arial;
}
.dataTable th,.dataTable td {padding:5px;}
.dataTable th {
  background-color:navy;
  color:white;
  text-transform:capitalize;
  }
.dataTable tbody tr:nth-child(2n) {background-color:lightBlue;}

.dataTable tbody tr td:nth-child(1) {
  background:linear-gradient(to right,navy,blue);
  color:white;
}
.dataTable caption {
  font-size:10pt;
  font-weight:bold;
  caption-side:left;
  border:solid 2px navy;
  padding:5px;
}
      </style>
            <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
            
            <script src="https://gmousse.github.io/dataframe-js/dist/dataframe.min.js"></script>   
      </head>
      <body>
            <H1> Midlands River </H1>
            <br>
This table is displaying data from a demo CSV file which can be found <a href="https://www.waterqualitydata.us/data/Result/search?organization=MRC&amp;characteristicName=Escherichia%20coli&amp;mimeType=csv&amp;zip=no&amp;dataProfile=narrowResult" target="_blank">here</a>.
            <br>
            <pre id = "group"></>
            <pre id = "gg"></>
            <script>
            var display = (text,elementSelector)=>document.querySelector(elementSelector).textContent = text;
                  const DataFrame = dfjs.DataFrame;
                  DataFrame.prototype.showHtml = function(targetPath,caption){
  var columns = this.listColumns();
  var table = `<table class="dataTable">
<caption>${caption}</caption>
<thead>
<tr>${columns.map((column)=>`<th>${column}</th>`).join('')}</tr>
</thead>
<tbody>
${this.toArray().map((row)=>`<tr>${columns.map((column,index)=>`<td>${row[index]}</td>`).join("")}</tr>`).join("")} 
</tbody>
</table>`;
document.querySelector(targetPath).innerHTML = table; 
  return this; 
};
DataFrame.fromCSV(
"https://www.waterqualitydata.us/data/Result/search?organization=MRC&characteristicName=Escherichia%20coli&mimeType=csv&zip=no&dataProfile=narrowResult"
                  ).then(df => {
//console.log(df.listColumns());
//df.show(3);
const shortDF = df.select('MonitoringLocationIdentifier','ActivityStartDate','ActivityStartTime/Time','CharacteristicName','ResultMeasureValue','ResultMeasure/MeasureUnitCode').renameAll(['Stat','Date','Time','Parm','Result','Unit']).cast('Result', Number).map(row => row.set('Year', row.get('Date').split("-",1))).restructure(['Year','Stat','Date','Time','Parm','Result','Unit']).sortBy(['Year','Stat','Date']);
                        
                      shortDF.show(3);
                      //shortDF.showHtml("#group","Group by");
                        
                     const numDF = shortDF.groupBy('Year').aggregate(group => group.count()).rename("aggregation","samples");
                     numDF.showHtml("#group","Count");
                     
                     const dataDf = shortDF.groupBy('Year').aggregate(gdf => gdf.toArray("Result")).rename("aggregation","results");
                     dataDf.show(3);
                     const chartDF = dataDf.map(row => row.set('chart', '<script>$("#sparkline").sparkline(['+row.get('results')+ '], {type: "box",raw: true});<script/>')).select("Year","chart");
                     const outDF = numDF.innerJoin[chartDF,'Year'];
                     outDF.show();
                     console.log(outDF);
                     //outDF.showHtml("#group","Count");
                           //console.log(dataDf);
                     
                     
                  });
             </script>                 
      </body>
</html>
